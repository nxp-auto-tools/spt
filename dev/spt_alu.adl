/*
 * Copyright 2020-2021 NXP
 * SPDX-License-Identifier: GPL-3.0+
 */

define (arch=spt_alu) {

  define (instrfield=shift_fld) {
    bits = 120;
    enumerated = ((".noshift",""),".shift");
    value = "";
  }

  define (instrfield=modulo_val) {
    bits = (100,96);
    enumerated = (
      ".mod0",  ".mod1",  ".mod2",  ".mod3",  ".mod4",  ".mod5",
      ".mod6",  ".mod7",  ".mod8",  ".mod9",  ".mod10", ".mod11",
      ".mod12", ".mod13", ".mod14", ".mod15", ".mod16", ".mod17",
      ".mod18", ".mod19", ".mod20", ".mod21", ".mod22", ".mod23",
      (".mod24",""));
  }

/*
add shift modulo_val src1_add, src2_add, dest_add
add shift modulo_val src1_add, imm_dat, dest_add
*/

  define (instr = add_r) {

    width = 128;
    fields = (
              /* 127:112 */ opcode(0x3), immed_or_reg_src_fld(1), shift_fld, /* reserved */
              /* 111: 96 */ /* reserved */ modulo_val,
              /*  95: 80 */ src_add,
              /*  79: 64 */ dest_add,
              /*  63: 48 */ src2_add,
              /*  47:  0 */ imm_dat(0));

    /*              1  2  3   4  5 */
    syntax = ("add %f %f %f, %f, %f",
               /* 1 */ shift_fld,
               /* 2 */ modulo_val,
               /* 3 */ src_add,
               /* 4 */ src2_add,
               /* 5 */ dest_add);

    /*               1  2  3          4       5 */
    dsyntax = ("add %f %f %f%f_%f%f, %f%f_%f%f, %f%f_%f%f",
               /* 1 */ shift_fld,
               /* 2 */ modulo_val,
               /* 3 */ DS_MEM1(src_add),
               /* 4 */ DS_MEM2(src2_add),
               /* 5 */ DS_MEM(dest_add));

    asm_rules = (R_src_valid_loc,
                 R_dest_valid_loc,
                 R_src2_valid_reg);

    action = { };
  };


  define (instr = add_i) {

    width = 128;
    fields = (
              /* 127:112 */ opcode(0x3), immed_or_reg_src_fld(0), shift_fld, /* reserved */
              /* 111: 96 */ /* reserved */ modulo_val,
              /*  95: 80 */ src_add,
              /*  79: 64 */ dest_add,
              /*  63: 48 */ src2_add(0),
              /*  47:  0 */ imm_dat);

    /*             1  2  3   4    5 */
    syntax = ("add %f %f %f, #%f, %f",
              /* 1 */ shift_fld,
              /* 2 */ modulo_val,
              /* 3 */ src_add,
              /* 4 */ imm_dat,
              /* 5 */ dest_add);

    /*               1  2  3        4   5 */
    dsyntax = ("add %f %f %f%f_%f%f, #%f, %f%f_%f%f",
               /* 1 */ shift_fld,
               /* 2 */ modulo_val,
               /* 3 */ DS_MEM1(src_add),
               /* 4 */ imm_dat,
               /* 5 */ DS_MEM(dest_add));

    asm_rules = (R_src_valid_loc,
                 R_dest_valid_loc);

    action = { };
  };


/*
sub shift modulo_val src1_add, src2_add, dest_add
sub shift modulo_val src1_add, imm_dat, dest_add
*/

  define (instr = sub_r) {

    width = 128;
    fields = (
              /* 127:112 */ opcode(0xB), immed_or_reg_src_fld(1), shift_fld, /* reserved */
              /* 111: 96 */ /* reserved */ modulo_val,
              /*  95: 80 */ src_add,
              /*  79: 64 */ dest_add,
              /*  63: 48 */ src2_add,
              /*  47:  0 */ imm_dat(0));

    /*              1  2  3  4   5 */
    syntax = ("sub %f %f %f, %f, %f",
               /* 1 */ shift_fld,
               /* 2 */ modulo_val,
               /* 3 */ src_add,
               /* 4 */ src2_add,
               /* 5 */ dest_add);

    /*               1  2  3       4       5 */
    dsyntax = ("sub %f %f %f%f_%f%f, %f%f_%f%f, %f%f_%f%f",
               /* 1 */ shift_fld,
               /* 2 */ modulo_val,
               /* 3 */ DS_MEM1(src_add),
               /* 4 */ DS_MEM2(src2_add),
               /* 5 */ DS_MEM(dest_add));

    asm_rules = (R_src_valid_loc,
                 R_dest_valid_loc,
                 R_src2_valid_reg);

    action = { };
  };

  define (instr = sub_i) {

    width = 128;
    fields = (
              /* 127:112 */ opcode(0xB), immed_or_reg_src_fld(0), shift_fld, /* reserved */
              /* 111: 96 */ /* reserved */ modulo_val,
              /*  95: 80 */ src_add,
              /*  79: 64 */ dest_add,
              /*  63: 48 */ src2_add(0),
              /*  47:  0 */ imm_dat);

    /*             1  2  3   4    5 */
    syntax = ("sub %f %f %f, #%f, %f",
              /* 1 */ shift_fld,
              /* 2 */ modulo_val,
              /* 3 */ src_add,
              /* 4 */ imm_dat,
              /* 5 */ dest_add);

    /*               1  2  3   4   5 */
    dsyntax = ("sub %f %f %f%f_%f%f, #%f, %f%f_%f%f",
               /* 1 */ shift_fld,
               /* 2 */ modulo_val,
               /* 3 */ DS_MEM1(src_add),
               /* 4 */ imm_dat,
               /* 5 */ DS_MEM(dest_add));

    asm_rules = (R_src_valid_loc,
                 R_dest_valid_loc);

    action = { };
  };


// cmp  src1_add, src2_add, dest_add
  define (instr=cmp) {
    width = 128;
    fields = (opcode(0xC),immed_or_reg_src_fld(1),imm_dat(0),src_add,src2_add,dest_add);

	dsyntax = ("cmp %f%f_%f%f, %f%f_%f%f, %f%f_%f%f",
			DS_MEM1(src_add),
			DS_MEM2(src2_add),
			DS_MEM(dest_add));
    syntax = ("cmp %f,%f,%f",src_add,src2_add,dest_add);
	asm_rules = (R_valid_cmp_operands);
    action = { };
  }

// cmp  src1_add, #imm, dest_add
  define (instr=cmpi) {
    width = 128;
    fields = (opcode(0xC),immed_or_reg_src_fld(0),imm_dat,src_add,src2_add(0),dest_add);

	dsyntax = ("cmp %f%f_%f%f, #%f, %f%f_%f%f",
			DS_MEM1(src_add),
			imm_dat,
			DS_MEM(dest_add));
    syntax = ("cmp %f,#%f,%f",src_add,imm_dat,dest_add);
	asm_rules = (R_valid_cmp_operands);
    action = { };
  }


  define (instrfield=sel_re_im) {
	// SEL
    bits = 121;
    enumerated = (".im", ".re");
  }

  define (instrfield=sel_wr) {
	// SEL, JUMP
    bits = (85,80);
	valid_ranges = (0, 47);
  }

  define (instrfield=sel_src3_add) {
    // SEL
    bits = (47,32);
  }

  define (instrfield=sel_src1_add) {
    // SEL
    bits = (31,16);
  }

// sel  re_im sel_wr, src1_add, src2_add, src3_add, dest_add
  define (instr=sel) {
    width = 128;
    fields = (opcode(0xE), sel_re_im, sel_wr,
        dest_add,
        src2_add,
        sel_src3_add,
        sel_src1_add);

	dsyntax = ("sel %f %f %f%f_%f%f, %f%f_%f%f, %f%f_%f%f, %f%f_%f%f", sel_re_im, ds_wr(sel_wr),
			DS_MEM1(sel_src1_add),
			DS_MEM2(src2_add),
			DS_MEM3(sel_src3_add),
			DS_MEM(dest_add)
			);
    syntax = ("sel %f %f %f,%f,%f,%f", sel_re_im, sel_wr, sel_src1_add, src2_add, sel_src3_add, dest_add);
	asm_rules = (R_valid_sel_operands);
    action = { };
  }

} // EOF
